"use strict";(self["webpackChunkquasarteste2"]=self["webpackChunkquasarteste2"]||[]).push([[994],{8994:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var s=n(3673);const r={style:{width:"50vw"}},o={class:"text-center q-mt-md"},l=(0,s.Uk)("Print");function a(e,t,n,a,i,c){const h=(0,s.up)("q-input"),d=(0,s.up)("q-btn"),g=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(g,{class:"flex flex-center"},{default:(0,s.w5)((()=>[(0,s._)("div",r,[(0,s._)("div",null,[(0,s.Wm)(h,{label:"Message",modelValue:i.msg,"onUpdate:modelValue":t[0]||(t[0]=e=>i.msg=e),type:"textarea",class:"text-black full-width",style:{height:"100px"},rows:"10"},null,8,["modelValue"])]),(0,s._)("div",o,[(0,s.Wm)(d,{color:"primary",class:"full-width",onClick:t[1]||(t[1]=e=>c.print())},{default:(0,s.w5)((()=>[l])),_:1})])])])),_:1})}n(7280),n(5363);const i={name:"PageIndex",data(){return{msg:"",printCharacteristic:null,isMobile:this.$q.platform.is.mobile}},methods:{print(){navigator.bluetooth.requestDevice({filters:[{name:"BlueTooth Printer",services:["000018f0-0000-1000-8000-00805f9b34fb"]}]},{optionalServices:["00002af1-0000-1000-8000-00805f9b34fb"]}).then((e=>(console.log("device",e),e.gatt.connected&&e.gatt.disconnect(),console.log("connect"),this.connect(e)))).catch(this.handleError)},connect(e){const t=this;return e.addEventListener("gattserverdisconnected",this.onDisconnected),e.gatt.connect().then((e=>e.getPrimaryService("000018f0-0000-1000-8000-00805f9b34fb"))).then((e=>e.getCharacteristic("00002af1-0000-1000-8000-00805f9b34fb"))).then((n=>{console.log("characteristic",n),t.printCharacteristic=n,t.sendTextData(e)})).catch((t=>{this.handleError(t,e)}))},handleError(e,t){console.error("handleError => error",e),null!=t&&t.gatt.disconnect();let n=JSON.stringify({code:e.code,message:e.message,name:e.name});console.log("handleError => erro",n),8!==e.code&&this.$q.notify("Could not connect with the printer. Try it again")},getBytes(e){console.log("text",e);let t="\n\r";e=void 0===e?t:e;let n=this.$languages.replace(e);console.log("replaced",n);let s=new TextEncoder("utf-8").encode(n+t);return console.log("bytes",s),s},addText(e){let t=this.msg;if(e.push(t),this.isMobile)while(t.length>=20){let n=t.substring(20);e.push(n),t=n}},sendTextData(e){let t=[];this.addText(t),console.log("sendTextData => arrayText",t),this.loop(0,t,e)},loop(e,t,n){let s=this.getBytes(t[e]);this.write(n,s,(()=>{if(e++,e<t.length)this.loop(e,t,n);else{let e=this.getBytes();this.write(n,e,(()=>{n.gatt.disconnect()}))}}))},write(e,t,n){this.printCharacteristic.writeValue(t).then((()=>{console.log("Printed Array: "+t.length),setTimeout((()=>{n&&n()}),250)})).catch((t=>{this.handleError(t,e)}))}}};var c=n(4260),h=n(4379),d=n(4842),g=n(8240),u=n(7518),f=n.n(u);const p=(0,c.Z)(i,[["render",a]]),m=p;f()(i,"components",{QPage:h.Z,QInput:d.Z,QBtn:g.Z})}}]);